{"mappings":"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","sources":["src/index.ts","src/commands.ts","src/helpers.ts","src/commonAuthors.ts"],"sourcesContent":["import { Client, Intents } from 'discord.js';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport dayjs from \"dayjs\";\nimport Keyv from \"@keyvhq/core\";\nimport KeyvSQLite from \"@keyvhq/sqlite\";\nimport { commands } from './commands';\n\n\nconst token = process.env[\"DISCORD_TOKEN\"]; \ndayjs.extend(relativeTime)\n\nconst db = new Keyv({ store: new KeyvSQLite(\"sqlite://./database.sqlite\") })\n\nconst client = new Client({\n    intents: [Intents.FLAGS.GUILDS, Intents.FLAGS.GUILD_MESSAGES],\n})\n\n\n\nclient.on('debug', console.log);\n\nclient.once('ready', () => {\n    console.log(`${client.user.tag} is ready`)\n})\n\nclient.on('messageCreate', async (msg) => {\n    for (const command of commands) {\n        const { condition, action } = command;\n        if (condition(msg, client)) {\n            await action(msg, db);\n            break;\n        }\n    }\n});\n\nclient.login(token);\n","import Keyv from \"@keyvhq/core\";\nimport { Client, Message, MessageEmbed } from \"discord.js\"\nimport { resetClock, shouldReset } from \"./helpers\";\nimport dayjs from \"dayjs\";\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport cache from \"node-cache\"\nimport Sheets from \"node-sheets\"\nimport { authors } from \"./commonAuthors\";\ndayjs.extend(relativeTime)\n\nconst API_KEY = process.env[\"GOOGLE_API_KEY\"];\nconst SHEET_ID = process.env[\"SHEET_ID\"];\n\nconst sheetCache = new cache();\nconst randomQueue: Row[] = [];\n\ntype Command = {\n    condition: (message: Message, client: Client) => boolean,\n    action: (message: Message, db: Keyv) => Promise<void>\n}\n\nconst isBot: Command = {\n    condition: (message) => message.author.bot,\n    action: async (_m, _db) => { }\n};\n\nconst hasGuild: Command = {\n    condition: (message) => !message.guild,\n    action: async (_m, _db) => { }\n}\n\nconst reset: Command = {\n    condition: (message) => shouldReset(message.content),\n    action: async (message, db) => { await resetClock(message, message.guild.id, db) }\n}\n\nconst getTime: Command = {\n    condition: (message, client) => message.content === \"!time not forgotten\" ||\n        (\n            message.mentions.has(client.user) && message.content.includes(\"time\")\n        ),\n    action: async (message, db) => {\n        const server = message.guild.id;\n        const date = await db.get(server)\n        const user = await db.get(`${server}-user`)\n        const lastDate = dayjs(JSON.parse(date))\n        if (user) {\n            message.reply(`${user} invoked the eternal message of neither forgiving nor forgetting ` + lastDate.fromNow())\n        } else {\n            message.reply(\"We have neither forgiven nor forgotten in \" + lastDate.fromNow(true))\n        }\n    }\n}\n\nconst replyYes: Command = {\n    condition: (message, client) => message.mentions.has(client.user) && message.content.includes(\"?\"),\n    action: async (message) => { message.reply(\"Yes.\") }\n}\n\nconst hestia: Command = {\n    condition: (message) => message.content.toLowerCase().includes(\"hestia is bestia\"),\n    action: async (message) => { message.reply(\"https://giphy.com/gifs/hestia-bestia-whS3qTYrdCMj5cOXuq\") }\n}\n\nconst artemis: Command = {\n    condition: (message) => message.content.toLowerCase().includes(\"no arty no party\"),\n    action: async (message) => { message.reply(\"https://tenor.com/view/artemis-love-liefde-godin-jacht-gif-20277855\") }\n}\n\nconst help: Command = {\n    condition: (message, client) => message.mentions.has(client.user) && message.content.toLowerCase().includes(\"help\"),\n    action: async (message) => {\n        message.reply(`Here's what I can do:\n**I do not forgive, I do not forget**: Remark upon this solemn phrase and record it's use in history.\n\n**@ACV-Clock time** or **!time not forgotten**: Remind you of the last recorded utterance of this legendary phrase.\n\n**No arty no party**: Showcase artemis in all her splendor.\n\n**Hestia is bestia**: Showcase hestia in all her splendor.\n\n**@ACV-Clock quote me bb**: A randomly selected flowerpot quote\n\n**@ACV-Clock throw me a gem bb**: A randomly selected flowerpot quote from a lesser known but no less great author`)\n    }\n}\n\ntype Row = {\n    [id: string]: { value: string, stringValue: string };\n}\n\ntype GSheet = {\n    rows: Row[]\n}\n\nconst getTable = async () => {\n    let table: GSheet = sheetCache.get('quotes')\n    if (!table) {\n        console.log(\"not in cache, fetching\")\n        const gs = new Sheets(SHEET_ID);\n        await gs.authorizeApiKey(API_KEY);\n        table = await gs.tables(\"Responses!A:D\");\n        sheetCache.set('quotes', table, 300);\n    }\n    return table;\n}\n\nconst embedFromRow = (row: Row) => {\n    const author = row.Author.stringValue.trim()\n    const quote = row.Quote.stringValue.trim()\n    const link = row.Link ? row.Link.stringValue.trim() : \"\"\n    return new MessageEmbed()\n        .setTitle(author)\n        .setDescription(quote)\n        .setURL(link);\n}\n\nconst maintainQueue = () => {\n    if (randomQueue.length >= 5) {\n        randomQueue.pop()\n    }\n}\n\nconst getRandom = (items: Row[]): Row => {\n    const randIndex = Math.floor(Math.random() * items.length);\n    let row = items[randIndex];\n    if (randomQueue.some(q => q === row)) {\n        row = items[randIndex];\n    } else {\n        randomQueue.push(row)\n    }\n    maintainQueue()\n    return row\n}\n\nconst quote: Command = {\n    condition: (message, client) => {\n        const quoteMeBb = message.mentions.has(client.user) && message.content.includes(\"quote me bb\")\n        const isRedDragon = message.author.id === \"160158668422119424\" && message.content.includes(\"quiet\") && message.content.includes(\"night\");\n        const isQuote = message.content === \"!quote\"\n        return quoteMeBb || isRedDragon || isQuote;\n    },\n    action: async (message) => {\n        try {\n            const table = await getTable();\n            const row = getRandom(table.rows);\n            message.channel.send({ embeds: [embedFromRow(row)] });\n        } catch (error) {\n            message.reply(\"Sorry, but no.\")\n        }\n    }\n}\n\nconst uncommonQuote: Command = {\n    condition: (message, client) => {\n        const quoteMeBb = message.mentions.has(client.user) && message.content.includes(\"throw me a gem bb\")\n        const isQuote = message.content === \"!quote\"\n        return quoteMeBb || isQuote;\n    },\n    action: async (message) => {\n        try {\n            let table = await getTable();\n            table = { rows: table.rows.filter(row => !authors.has(row.Author.stringValue.trim().toLowerCase())) };\n            const row = getRandom(table.rows)\n            message.channel.send({ embeds: [embedFromRow(row)] });\n        } catch (error) {\n            message.reply(\"Sorry, but no.\")\n        }\n    }\n}\n\n\nexport const commands: Command[] = [\n    isBot,\n    hasGuild,\n    reset,\n    getTime,\n    replyYes,\n    hestia,\n    artemis,\n    quote,\n    uncommonQuote,\n    help,\n]\n","import { Message } from \"discord.js\";\n\nexport function shouldReset(content: string) {\n    return content.search(/(will not|shall not|do not|don't|shan't|won't) (forgive|forget).*(forgive|forget)/g) > 0\n}\n\nexport interface KV {\n    set: (key: string, value: any, ttl?: number) => void,\n    get: (key: string) => any,\n}\n\nexport async function resetClock(msg: Message, path: string, db: KV) {\n    msg.reply('Resetting the clock!');\n    msg.channel.send(\"https://c.tenor.com/m1vBPcWl69sAAAAM/reset-the-clock-pacific-rim.gif\")\n    await db.set(path, newResetDate())\n    await db.set(`${path}-user`, msg.author.toString())\n}\n\nexport function newResetDate() { return JSON.stringify(new Date()); }","export const authors = new Set([\n    \"darknessenthroned\",\n    \"davidtheathenai\",\n    \"ajjaxx\",\n    \"theblack'sresurgence\",\n    \"durararaaa\",\n    \"liberty1prime\",\n    \"djkopper\",\n    \"sophprosyne\",\n    \"charlennette\",\n    \"e.c. scrubb\",\n    \"aci100\",\n    \"arms of atlas\",\n    \"sal-tal\",\n    \"ward\",\n])"],"names":[],"version":3,"file":"main.js.map"}